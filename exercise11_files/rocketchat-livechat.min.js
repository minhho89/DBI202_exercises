!function(e){"use strict";function t(){}function n(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function i(e){return function(){return this[e].apply(this,arguments)}}function o(e){return"function"==typeof e||e instanceof RegExp||!(!e||"object"!=typeof e)&&o(e.listener)}var r=t.prototype,s=e.EventEmitter;r.getListeners=function(e){var t,n,i=this._getEvents();if(e instanceof RegExp){t={};for(n in i)i.hasOwnProperty(n)&&e.test(n)&&(t[n]=i[n])}else t=i[e]||(i[e]=[]);return t},r.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},r.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},r.addListener=function(e,t){if(!o(t))throw new TypeError("listener must be a function");var i,r=this.getListenersAsObject(e),s="object"==typeof t;for(i in r)r.hasOwnProperty(i)&&-1===n(r[i],t)&&r[i].push(s?t:{listener:t,once:!1});return this},r.on=i("addListener"),r.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},r.once=i("addOnceListener"),r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},r.removeListener=function(e,t){var i,o,r=this.getListenersAsObject(e);for(o in r)r.hasOwnProperty(o)&&-1!==(i=n(r[o],t))&&r[o].splice(i,1);return this},r.off=i("removeListener"),r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,n){var i,o,r=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(i=n.length;i--;)r.call(this,t,n[i]);else for(i in t)t.hasOwnProperty(i)&&(o=t[i])&&("function"==typeof o?r.call(this,i,o):s.call(this,i,o));return this},r.removeEvent=function(e){var t,n=typeof e,i=this._getEvents();if("string"===n)delete i[e];else if(e instanceof RegExp)for(t in i)i.hasOwnProperty(t)&&e.test(t)&&delete i[t];else delete this._events;return this},r.removeAllListeners=i("removeEvent"),r.emitEvent=function(e,t){var n,i,o,r,s=this.getListenersAsObject(e);for(r in s)if(s.hasOwnProperty(r))for(n=s[r].slice(0),o=0;o<n.length;o++)i=n[o],!0===i.once&&this.removeListener(e,i.listener),i.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,i.listener);return this},r.trigger=i("emitEvent"),r.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},r.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},r._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},r._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return e.EventEmitter=s,t},"object"==typeof module&&module.exports?module.exports=t:e.EventEmitter=t}(this||{}),function(e){e.RocketChat=e.RocketChat||{_:[]};var t,n,i,o,r={},s=[],a=!1,c=!1,u="800px",d="600px",l=["chat-maximized","chat-minimized","chat-started","chat-ended","pre-chat-form-submit","offline-form-submit"],h=new EventEmitter,f=function(e,t){return-1!==l.indexOf(e)&&h.on(e,t)},m=function(e,t){void 0!==t?h.emit(e,t):h.emit(e)},p=function(e,t){if(!a)return s.push(arguments);var i={src:"rocketchat",fn:e,args:t};n.contentWindow.postMessage(i,"*")},g=function(){"closed"!==t.dataset.state&&(c&&(document.body.style.cssText=i,document.body.scrollTop=o),t.dataset.state="closed",t.style.height="30px",t.style.right="50px",t.style.bottom="0px",p("widgetClosed"),m("chat-minimized"))},v=function(){"opened"!==t.dataset.state&&(c&&(o=document.body.scrollTop,i=document.body.style.cssText,document.body.style.cssText+="overflow: hidden; height: 100%; width: 100%; position: fixed; top:"+o+"px;"),t.dataset.state="opened",t.style.height=d,p("widgetOpened"),document.querySelector(".rocketchat-widget iframe").focus(),m("chat-maximized"))},y={ready:function(){a=!0,s.length>0&&(s.forEach(function(e){p.apply(this,e)}),s=[])},toggleWindow:function(){"closed"===t.dataset.state?v():g()},restoreWindow:function(){"closed"===t.dataset.state&&v()},startDragWindow:function(e){"opened"===t.dataset.state&&(this.dragOffset=e)},stopDragWindow:function(){"opened"===t.dataset.state&&(this.dragOffset=null)},dragWindow:function(e){if(this.dragOffset){var n=parseInt(t.style.right.replace(/px$/,""),10),i=parseInt(t.style.bottom.replace(/px$/,""),10);t.style.right=n-(e.x-this.dragOffset.x)+"px",t.style.bottom=i-(e.y-this.dragOffset.y)+"px"}},openPopout:function(){g(),window.open(r.url+"?mode=popout","livechat-popout","width=400, height=450, toolbars=no").focus()},openWidget:function(){v()},removeWidget:function(){document.getElementsByTagName("body")[0].removeChild(t)},callback:function(e,t){m(e,t)}},w=function(e){p("pageVisited",{change:e,location:JSON.parse(JSON.stringify(document.location)),title:document.title})},x=function(e,t,n){void 0===n&&(n=!0),p("setCustomField",[e,t,n])},E=function(e){p("setTheme",e)},b=function(e){p("setDepartment",e)},L=function(e){p("setGuestToken",e)},R=function(e){p("setGuestName",e)},k=function(e){p("setGuestEmail",e)},O=function(e){p("registerGuest",e)},C=function(){p("clearDepartment")},T={href:null,title:null},_=function(){setInterval(function(){document.location.href!==T.href&&(w("url"),T.href=document.location.href),document.title!==T.title&&(w("title"),T.title=document.title)},800)},G=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),i=n.exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},P=function(i){if(i){p("setGuestName",G("xTerName",i)),p("setGuestEmail",G("xTerEmail",i)),console.log("param hannah:",G("hannah",i),"param showheader:",G("showheader",i));var o=!0,s="50px";"false"==G("showheader",i)&&(o=!1),"true"===G("hannah",i)&&!0,o||(u="100%",d="100%",s="0px"),p("setHannah",G("hannah",i)),p("setDepartment",G("xTerDepartment",i)),p("setshowHeader",G("showheader",i)),r.url=i.split("?")[0];var a=document.createElement("div");a.dataset.state="closed",a.className="rocketchat-widget",a.innerHTML='<div class="rocketchat-container" style="width:100%;height:100%"><iframe id="rocketchat-iframe" src="'+i+'" style="width:100%;height:100%;border:none;background-color:transparent" allowTransparency="true"></iframe> </div><div class="rocketchat-overlay"></div>',a.style.position="fixed",a.style.width=u,a.style.height="30px",a.style.borderTopLeftRadius="5px",a.style.borderTopRightRadius="5px",a.style.bottom="0",a.style.right=s,a.style.zIndex="12345",o||(a.style.height=d),document.getElementsByTagName("body")[0].appendChild(a),t=document.querySelector(".rocketchat-widget"),n=document.getElementById("rocketchat-iframe"),e.addEventListener("message",function(e){if("object"==typeof e.data&&void 0!==e.data.src&&"rocketchat"===e.data.src&&void 0!==y[e.data.fn]&&"function"==typeof y[e.data.fn]){var t=[].concat(e.data.args||[]);y[e.data.fn].apply(null,t)}},!1);var l=function(e){e.matches?(c=!0,a.style.left="0",a.style.right="0",a.style.width="100%"):(a.style.left="auto",a.style.right=s,a.style.width=u)},h=window.matchMedia("screen and (max-device-width: 480px)");l(h),h.addListener(l),_()}};void 0!==e.initRocket&&(console.warn("initRocket is now deprecated. Please update the livechat code."),P(e.initRocket[0])),void 0!==e.RocketChat.url&&P(e.RocketChat.url);var j=e.RocketChat._;e.RocketChat=e.RocketChat._.push=function(t){t.call(e.RocketChat.livechat)},e.RocketChat.livechat={pageVisited:w,setCustomField:x,setTheme:E,setDepartment:b,clearDepartment:C,setGuestToken:L,setGuestName:R,setGuestEmail:k,registerGuest:O,onChatMaximized:function(e){f("chat-maximized",e)},onChatMinimized:function(e){f("chat-minimized",e)},onChatStarted:function(e){f("chat-started",e)},onChatEnded:function(e){f("chat-ended",e)},onPrechatFormSubmit:function(e){f("pre-chat-form-submit",e)},onOfflineFormSubmit:function(e){f("offline-form-submit",e)}},j.forEach(function(t){t.call(e.RocketChat.livechat)})}(window);